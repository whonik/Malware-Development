/*Task: Startup a process of your choosing, and print out some values like the PID, TID and Handles for the subsequent processes/threads. 
Then, have it wait for the process or thread to finish using an API like WaitForSingleObject()
before closing the handles to your thread and process, using an API like CloseHandle()*/

#include<stdio.h>
#include <Windows.h>

STARTUPINFOW si={0};
PROCESS_INFORMATION pi={0};

int main(){
    
    //creating a process

    int newProcess = CreateProcessW(
        L"C:\\Windows\\System32\\notepad.exe",
        NULL,
        NULL,
        NULL,
        FALSE,
        BELOW_NORMAL_PRIORITY_CLASS,
        NULL,
        NULL,
        &si,
        &pi
    );
/*DWORD WaitForSingleObject(
  [in] HANDLE hHandle,
  [in] DWORD  dwMilliseconds
);

BOOL CloseHandle(
  [in] HANDLE hObject
);
*/    

    if(newProcess){
        printf("(+) New Process created Successfully ...\n");
        printf("\t[+] Process id : %ld\n", pi.dwProcessId);
        printf("\t[+] Thread id : %ld\n",pi.dwThreadId);
        printf("\t[+] Handle Values : %ld\t , %ld\n", pi.hThread , pi.hProcess);      
        WaitForSingleObject(pi.hProcess,5000);                                      //waiting for 5 sec
        CloseHandle(pi.hThread);                                                    //have to close both handle and process
        CloseHandle(pi.hProcess);
        printf("\t[!] exiting ..\n");
        return EXIT_SUCCESS;

    } 
    else{
        printf("\t(-) Failed to Create new Process ...\n");
        printf("\t[-] Exiting with error: %ld\n", GetLastError());
        return EXIT_FAILURE;
    } 

    return EXIT_SUCCESS;
}